# BigData/Bigtable Emulator provisioner
# Provides a simple HTTP service that simulates BigData operations

- uri: template://custom/bigdata-emulator
  type: bigdata-emulator
  services: |
    bigdata-emulator:
      image: nginx:alpine
      ports:
        - target: 80
          published: 9000
      volumes:
        - type: bind
          source: ${.WorkloadDir}/scripts/bigdata-emulator.conf
          target: /etc/nginx/conf.d/default.conf
      healthcheck:
        test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost/health"]
        interval: 10s
        timeout: 5s
        retries: 3
  
  state: |
    host: bigdata-emulator
    port: "9000"
    apiKey: ${.Params.apiKey | default "bigdata-api-key-12345"}
  
  outputs: |
    host: ${.State.host}
    port: ${.State.port}
    apiKey: ${.State.apiKey}
